<!DOCTYPE html>
<html>
<head>
    <title>Bitcoin Portfolio Calculator</title>
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .calculator { 
            max-width: 900px; 
            margin: 20px auto; 
            padding: 30px; 
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        .input-section {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .input-group { 
            margin: 15px 0; 
        }
        .input-group label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 600;
            color: #333;
        }
        .input-group input, 
        .input-group select { 
            width: 100%; 
            padding: 12px; 
            font-size: 16px; 
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }
        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }
        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
            transform: scale(1.2);
        }
        .checkbox-group label {
            margin: 0;
            font-weight: 500;
        }
        .slider-container {
            margin: 15px 0;
        }
        .slider-container label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        .slider-wrapper {
            position: relative;
            margin: 10px 0;
        }
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, #28a745 0%, #ffc107 50%, #dc3545 100%);
            outline: none;
            -webkit-appearance: none;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
            margin-top: 8px;
        }
        .slider-value {
            text-align: center;
            font-weight: bold;
            color: #667eea;
            margin-top: 5px;
        }
        .calculate-btn { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; 
            padding: 15px 40px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 18px; 
            font-weight: 600;
            margin: 20px auto;
            display: block;
            transition: transform 0.2s;
        }
        .calculate-btn:hover {
            transform: translateY(-2px);
        }
        .results { 
            margin-top: 40px; 
        }
        .results h2 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .portfolio-card { 
            border: 2px solid #e1e5e9;
            padding: 25px; 
            margin: 20px 0; 
            border-radius: 12px;
            transition: all 0.3s;
        }
        .portfolio-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .portfolio-card h3 { 
            color: #333; 
            margin-top: 0;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .rank-badge {
            font-size: 2em;
        }
        .allocation-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); 
            gap: 15px; 
            margin: 20px 0; 
        }
        .allocation-item { 
            text-align: center; 
            padding: 15px; 
            background: #f8f9fa; 
            border-radius: 8px;
            border: 1px solid #e1e5e9;
        }
        .allocation-item strong {
            color: #333;
            font-size: 1.1em;
        }
        .metrics { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
            gap: 20px; 
            margin: 25px 0; 
        }
        .metric { 
            text-align: center; 
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .metric-value { 
            font-size: 24px; 
            font-weight: bold; 
            color: #667eea; 
        }
        .metric-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
        .status-indicator {
            margin-top: 5px;
            font-size: 1.2em;
        }
        .feasible { 
            border-color: #28a745; 
            background-color: #f8fff9; 
        }
        .not-feasible { 
            border-color: #dc3545; 
            background-color: #fff5f5; 
        }
        .warning-card {
            border: 2px solid #ffc107;
            background-color: #fff9e6;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }
        .implementation-steps {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }
        .implementation-steps h4 {
            margin-top: 0;
            color: #333;
        }
        .implementation-steps ol {
            margin: 10px 0 0 20px;
            line-height: 1.6;
        }
        .projection-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .projection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .projection-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
        }
        .projection-value {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
        }
        .comparison-highlight {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }
        .strategy-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .dividend-focused {
            background: #28a745;
            color: white;
        }
        .growth-focused {
            background: #dc3545;
            color: white;
        }
        .balanced-focus {
            background: #ffc107;
            color: #333;
        }
        @media (max-width: 768px) {
            .input-section {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            .calculator {
                margin: 10px;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="calculator">
        <h1>🚀 Bitcoin Portfolio Calculator</h1>
        <p class="subtitle">Find the optimal portfolio composition for your financial goals</p>
        
        <div class="input-section">
            <div class="input-group">
                <label>💰 Starting Capital ($)</label>
                <input type="number" id="startingCapital" placeholder="25000" value="25000">
            </div>
            
            <div class="input-group">
                <label>📊 Maximum Drawdown Tolerance</label>
                <select id="maxDrawdown">
                    <option value="15">15% (Ultra Conservative)</option>
                    <option value="20">20% (Conservative)</option>
                    <option value="25">25% (Moderate Conservative)</option>
                    <option value="35" selected>35% (Balanced)</option>
                    <option value="50">50% (Moderate Aggressive)</option>
                    <option value="65">65% (Aggressive)</option>
                </select>
            </div>
            
            <div class="input-group">
                <label>🎯 Target Monthly Dividend Income ($)</label>
                <input type="number" id="targetIncome" placeholder="500" value="500">
            </div>
            
            <div class="input-group">
                <label>📈 Monthly Contribution Amount ($)</label>
                <input type="number" id="monthlyContribution" placeholder="1000" value="1000">
            </div>
            
            <div class="input-group">
                <label>⏰ Investment Time Horizon</label>
                <select id="timeHorizon">
                    <option value="1">1 year</option>
                    <option value="3">3 years</option>
                    <option value="5" selected>5 years</option>
                    <option value="10">10 years</option>
                    <option value="20">20+ years</option>
                </select>
            </div>
            
            <div class="slider-container">
                <label>⚖️ Investment Strategy Preference</label>
                <div class="slider-wrapper">
                    <input type="range" id="strategyBias" class="slider" min="1" max="10" value="5" oninput="updateSliderValue()">
                    <div class="slider-labels">
                        <span>🏦 Dividend Focused</span>
                        <span>🚀 Growth Focused</span>
                    </div>
                    <div class="slider-value" id="sliderValue">Balanced Approach</div>
                </div>
            </div>
        </div>
        
        <div class="checkbox-group">
            <input type="checkbox" id="reinvestDividends" checked>
            <label for="reinvestDividends">🔄 Automatically reinvest all dividends (Recommended for compound growth)</label>
        </div>
        
        <button class="calculate-btn" onclick="calculatePortfolios()">🔍 Find Best Portfolios</button>
        
        <div id="results" class="results"></div>
    </div>

    <script>
        // Asset database from generated analysis
        const assets = {
            'IBIT': { yield: 0.00, expectedReturn: 0.18, volatility: 0.78, risk: 4, name: 'iShares Bitcoin ETF', type: 'growth' },
            'MSTR': { yield: 0.00, expectedReturn: 0.22, volatility: 0.90, risk: 5, name: 'MicroStrategy', type: 'growth' },
            'STRF': { yield: 0.10, expectedReturn: 0.13, volatility: 0.12, risk: 2, name: 'Strategy Senior Preferred', type: 'income' },
            'STRK': { yield: 0.08, expectedReturn: 0.19, volatility: 0.38, risk: 3, name: 'Strategy Convertible Preferred', type: 'hybrid' },
            'STRD': { yield: 0.10, expectedReturn: 0.15, volatility: 0.18, risk: 3, name: 'Strategy High-Yield Preferred', type: 'income' },
            'STRC': { yield: 0.1025, expectedReturn: 0.1025, volatility: 0.06, risk: 1, name: 'Strategy Variable Rate Preferred', type: 'income' }
        };

        // Enhanced portfolio templates with strategy bias classifications
        const portfolioTemplates = [
            // Dividend-Focused Variants
            { 
                id: 'dividend_ultra', 
                name: 'Ultra Dividend Focus',
                maxDrawdown: 0.12, 
                strategyBias: 1, // Heavily dividend-focused
                allocations: { STRC: 65, STRF: 25, STRD: 5, STRK: 3, IBIT: 2, MSTR: 0 }
            },
            { 
                id: 'dividend_heavy', 
                name: 'High Dividend Focus',
                maxDrawdown: 0.18, 
                strategyBias: 2,
                allocations: { STRC: 50, STRF: 30, STRD: 10, STRK: 5, IBIT: 5, MSTR: 0 }
            },
            { 
                id: 'dividend_moderate', 
                name: 'Moderate Dividend Focus',
                maxDrawdown: 0.22, 
                strategyBias: 3,
                allocations: { STRC: 40, STRF: 25, STRD: 8, STRK: 12, IBIT: 10, MSTR: 5 }
            },
            
            // Original Balanced Templates
            { 
                id: 'ultra_cons', 
                name: 'Ultra Conservative Balanced',
                maxDrawdown: 0.15, 
                strategyBias: 4,
                allocations: { STRC: 55, STRF: 25, IBIT: 10, STRK: 5, MSTR: 3, STRD: 2 }
            },
            { 
                id: 'conservative', 
                name: 'Conservative Balanced',
                maxDrawdown: 0.20, 
                strategyBias: 4,
                allocations: { STRC: 40, STRF: 30, IBIT: 20, STRK: 5, MSTR: 5, STRD: 0 }
            },
            { 
                id: 'balanced', 
                name: 'True Balanced',
                maxDrawdown: 0.35, 
                strategyBias: 5,
                allocations: { STRC: 25, STRF: 20, IBIT: 25, STRK: 15, MSTR: 10, STRD: 5 }
            },
            { 
                id: 'mod_agg', 
                name: 'Moderate Growth Focus',
                maxDrawdown: 0.50, 
                strategyBias: 6,
                allocations: { STRC: 15, STRF: 15, IBIT: 30, STRK: 20, MSTR: 15, STRD: 5 }
            },
            
            // Growth-Focused Variants
            { 
                id: 'growth_moderate', 
                name: 'Moderate Growth Focus',
                maxDrawdown: 0.45, 
                strategyBias: 7,
                allocations: { STRC: 10, STRF: 10, IBIT: 35, STRK: 20, MSTR: 20, STRD: 5 }
            },
            { 
                id: 'growth_heavy', 
                name: 'High Growth Focus',
                maxDrawdown: 0.60, 
                strategyBias: 8,
                allocations: { STRC: 5, STRF: 5, IBIT: 40, STRK: 15, MSTR: 30, STRD: 5 }
            },
            { 
                id: 'growth_aggressive', 
                name: 'Aggressive Growth Focus',
                maxDrawdown: 0.70, 
                strategyBias: 9,
                allocations: { STRC: 5, STRF: 0, IBIT: 45, STRK: 10, MSTR: 35, STRD: 5 }
            },
            { 
                id: 'growth_maximum', 
                name: 'Maximum Growth Focus',
                maxDrawdown: 0.80, 
                strategyBias: 10,
                allocations: { STRC: 0, STRF: 0, IBIT: 50, STRK: 5, MSTR: 40, STRD: 5 }
            }
        ];

        // Update slider display
        function updateSliderValue() {
            const value = document.getElementById('strategyBias').value;
            const sliderValueDiv = document.getElementById('sliderValue');
            
            const labels = {
                1: 'Maximum Dividend Focus 🏦',
                2: 'High Dividend Focus 💰',
                3: 'Moderate Dividend Focus 📊',
                4: 'Slight Dividend Preference ⚖️',
                5: 'Balanced Approach ⚖️',
                6: 'Slight Growth Preference 📈',
                7: 'Moderate Growth Focus 🚀',
                8: 'High Growth Focus 🎯',
                9: 'Aggressive Growth Focus ⚡',
                10: 'Maximum Growth Focus 🔥'
            };
            
            sliderValueDiv.textContent = labels[value] || 'Balanced Approach';
        }

        // Calculate portfolio metrics including projections
        function calculatePortfolioMetrics(portfolio, startingCapital, monthlyContribution, timeHorizon, reinvestDividends) {
            let totalYield = 0;
            let weightedReturn = 0;
            let weightedVolatility = 0;
            
            // Calculate weighted averages
            for (const [asset, percentage] of Object.entries(portfolio.allocations)) {
                const weight = percentage / 100;
                totalYield += assets[asset].yield * weight;
                weightedReturn += assets[asset].expectedReturn * weight;
                weightedVolatility += assets[asset].volatility * weight;
            }
            
            // Calculate immediate dividend income
            const annualDividend = startingCapital * totalYield;
            const monthlyDividend = annualDividend / 12;
            
            // Project future values
            const projections = calculateFutureValue(
                startingCapital, 
                monthlyContribution, 
                weightedReturn, 
                totalYield,
                timeHorizon, 
                reinvestDividends
            );
            
            return {
                ...portfolio,
                effectiveYield: totalYield,
                expectedReturn: weightedReturn,
                estimatedVolatility: weightedVolatility,
                initialAnnualDividend: annualDividend,
                initialMonthlyDividend: monthlyDividend,
                ...projections
            };
        }

        // Calculate future value with compound growth and contributions
        function calculateFutureValue(startingCapital, monthlyContribution, expectedReturn, dividendYield, years, reinvestDividends) {
            let portfolioValue = startingCapital;
            let totalDividendsReceived = 0;
            let totalContributions = startingCapital;
            
            for (let year = 1; year <= years; year++) {
                // Add monthly contributions throughout the year
                const yearlyContributions = monthlyContribution * 12;
                portfolioValue += yearlyContributions;
                totalContributions += yearlyContributions;
                
                // Calculate annual dividends on current portfolio value
                const annualDividends = portfolioValue * dividendYield;
                totalDividendsReceived += annualDividends;
                
                // Reinvest dividends if selected
                if (reinvestDividends) {
                    portfolioValue += annualDividends;
                }
                
                // Apply capital appreciation (excluding dividend yield to avoid double counting)
                const capitalAppreciation = expectedReturn - dividendYield;
                portfolioValue *= (1 + capitalAppreciation);
            }
            
            // Calculate final year dividend income
            const finalYearDividends = portfolioValue * dividendYield;
            const finalMonthlyDividends = finalYearDividends / 12;
            
            return {
                finalPortfolioValue: portfolioValue,
                totalDividendsReceived: totalDividendsReceived,
                totalContributions: totalContributions,
                finalAnnualDividends: finalYearDividends,
                finalMonthlyDividends: finalMonthlyDividends,
                totalGrowth: portfolioValue - totalContributions + (reinvestDividends ? 0 : totalDividendsReceived)
            };
        }

        // Check if portfolio meets user criteria
        function meetsUserCriteria(portfolio, userInputs) {
            const criteria = {
                maxDrawdownOk: portfolio.maxDrawdown <= (userInputs.maxDrawdown / 100),
                initialDividendGoalMet: portfolio.initialMonthlyDividend >= userInputs.targetIncome,
                futureDividendGoalMet: portfolio.finalMonthlyDividends >= userInputs.targetIncome,
                strategyMatch: Math.abs(portfolio.strategyBias - userInputs.strategyBias) <= 2 // Allow some flexibility
            };
            
            criteria.overallFeasible = criteria.maxDrawdownOk && (criteria.initialDividendGoalMet || criteria.futureDividendGoalMet);
            
            return criteria;
        }

        // Enhanced scoring algorithm with strategy bias
        function calculatePortfolioScore(portfolio, userInputs) {
            let score = 0;
            
            // Strategy bias alignment (0-40 points) - Most important factor
            const biasDiff = Math.abs(portfolio.strategyBias - userInputs.strategyBias);
            score += Math.max(0, 40 - (biasDiff * 8));
            
            // Reward meeting dividend goal (0-35 points)
            if (portfolio.finalMonthlyDividends >= userInputs.targetIncome) {
                score += 35;
            } else if (portfolio.initialMonthlyDividend >= userInputs.targetIncome) {
                score += 30;
            } else {
                const bestDividend = Math.max(portfolio.initialMonthlyDividend, portfolio.finalMonthlyDividends);
                score += (bestDividend / userInputs.targetIncome) * 25;
            }
            
            // Risk tolerance alignment (0-15 points)
            const riskDiff = Math.abs(portfolio.maxDrawdown - (userInputs.maxDrawdown / 100));
            score += Math.max(0, 15 - (riskDiff * 50));
            
            // Expected returns bonus (0-10 points)
            score += Math.min(10, portfolio.expectedReturn * 40);
            
            return score;
        }

        // Get strategy badge
        function getStrategyBadge(strategyBias) {
            if (strategyBias <= 3) {
                return '<span class="strategy-badge dividend-focused">Dividend Focused</span>';
            } else if (strategyBias >= 7) {
                return '<span class="strategy-badge growth-focused">Growth Focused</span>';
            } else {
                return '<span class="strategy-badge balanced-focus">Balanced</span>';
            }
        }

        // Main calculation function
        function calculatePortfolios() {
            const userInputs = {
                startingCapital: parseFloat(document.getElementById('startingCapital').value) || 0,
                maxDrawdown: parseFloat(document.getElementById('maxDrawdown').value),
                targetIncome: parseFloat(document.getElementById('targetIncome').value) || 0,
                monthlyContribution: parseFloat(document.getElementById('monthlyContribution').value) || 0,
                timeHorizon: parseFloat(document.getElementById('timeHorizon').value),
                reinvestDividends: document.getElementById('reinvestDividends').checked,
                strategyBias: parseInt(document.getElementById('strategyBias').value)
            };

            // Validate inputs
            if (userInputs.startingCapital <= 0) {
                alert('Please enter a valid starting capital amount.');
                return;
            }

            // Calculate metrics for all portfolios
            const evaluatedPortfolios = portfolioTemplates.map(portfolio => {
                const withMetrics = calculatePortfolioMetrics(
                    portfolio, 
                    userInputs.startingCapital,
                    userInputs.monthlyContribution,
                    userInputs.timeHorizon,
                    userInputs.reinvestDividends
                );
                const criteria = meetsUserCriteria(withMetrics, userInputs);
                
                return {
                    ...withMetrics,
                    criteria: criteria,
                    score: calculatePortfolioScore(withMetrics, userInputs)
                };
            });

            // Sort by score and feasibility
            const sortedPortfolios = evaluatedPortfolios.sort((a, b) => {
                if (a.criteria.overallFeasible && !b.criteria.overallFeasible) return -1;
                if (!a.criteria.overallFeasible && b.criteria.overallFeasible) return 1;
                return b.score - a.score;
            });

            // Display results
            displayResults(sortedPortfolios.slice(0, 3), userInputs);
        }

        // Enhanced display results function
        function displayResults(portfolios, userInputs) {
            const resultsDiv = document.getElementById('results');
            
            if (portfolios.length === 0) {
                resultsDiv.innerHTML = '<p>No suitable portfolios found for your criteria.</p>';
                return;
            }
            
            let html = '<h2>🎯 Top 3 Portfolio Recommendations</h2>';
            
            // Strategy preference summary
            const strategyLabels = {
                1: 'Maximum Dividend Focus', 2: 'High Dividend Focus', 3: 'Moderate Dividend Focus',
                4: 'Slight Dividend Preference', 5: 'Balanced Approach', 6: 'Slight Growth Preference',
                7: 'Moderate Growth Focus', 8: 'High Growth Focus', 9: 'Aggressive Growth Focus', 10: 'Maximum Growth Focus'
            };
            
            html += `
            <div class="comparison-highlight">
                <strong>📊 Your Selected Strategy:</strong> ${strategyLabels[userInputs.strategyBias]} 
                ${getStrategyBadge(userInputs.strategyBias)}
            </div>`;
            
            portfolios.forEach((portfolio, index) => {
                const feasibilityClass = portfolio.criteria.overallFeasible ? 'feasible' : 'not-feasible';
                const rankEmojis = ['🥇', '🥈', '🥉'];
                
                html += `
                <div class="portfolio-card ${feasibilityClass}">
                    <h3>
                        ${portfolio.name} ${getStrategyBadge(portfolio.strategyBias)}
                        <span class="rank-badge">${rankEmojis[index]}</span>
                    </h3>
                    
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-value">$${portfolio.initialMonthlyDividend.toFixed(0)}</div>
                            <div class="metric-label">Initial Monthly Dividends</div>
                            <div class="status-indicator">${portfolio.initialMonthlyDividend >= userInputs.targetIncome ? '✅' : '❌'} Target: $${userInputs.targetIncome}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${(portfolio.maxDrawdown * 100).toFixed(0)}%</div>
                            <div class="metric-label">Max Drawdown Risk</div>
                            <div class="status-indicator">${portfolio.maxDrawdown <= (userInputs.maxDrawdown / 100) ? '✅' : '❌'} Limit: ${userInputs.maxDrawdown}%</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${(portfolio.expectedReturn * 100).toFixed(1)}%</div>
                            <div class="metric-label">Expected Annual Return</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${(portfolio.effectiveYield * 100).toFixed(2)}%</div>
                            <div class="metric-label">Portfolio Dividend Yield</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${portfolio.score.toFixed(0)}</div>
                            <div class="metric-label">Match Score (0-100)</div>
                            <div class="status-indicator">${Math.abs(portfolio.strategyBias - userInputs.strategyBias) <= 1 ? '🎯 Perfect Match' : '✅ Good Match'}</div>
                        </div>
                    </div>
                    
                    <div class="projection-section">
                        <h4>📊 ${userInputs.timeHorizon}-Year Projections</h4>
                        <div class="projection-grid">
                            <div class="projection-item">
                                <div class="projection-value">$${portfolio.finalPortfolioValue.toLocaleString()}</div>
                                <div>Final Portfolio Value</div>
                            </div>
                            <div class="projection-item">
                                <div class="projection-value">$${portfolio.finalMonthlyDividends.toLocaleString()}</div>
                                <div>Final Monthly Dividends</div>
                            </div>
                            <div class="projection-item">
                                <div class="projection-value">$${portfolio.totalDividendsReceived.toLocaleString()}</div>
                                <div>Total Dividends ${userInputs.reinvestDividends ? '(Reinvested)' : '(Cash)'}</div>
                            </div>
                            <div class="projection-item">
                                <div class="projection-value">$${portfolio.totalGrowth.toLocaleString()}</div>
                                <div>Total Growth</div>
                            </div>
                        </div>
                        
                        ${userInputs.strategyBias <= 4 ? 
                            `<div class="comparison-highlight">
                                <strong>💰 Dividend Strategy:</strong> This ${portfolio.strategyBias <= 3 ? 'dividend-focused' : 'balanced'} 
                                portfolio generates strong income with ${(portfolio.effectiveYield * 100).toFixed(2)}% current yield, 
                                providing steady cash flow ${userInputs.reinvestDividends ? 'for reinvestment and compound growth' : 'you can spend or reinvest'}.
                            </div>` : 
                            `<div class="comparison-highlight">
                                <strong>🚀 Growth Strategy:</strong> This growth-focused portfolio emphasizes capital appreciation 
                                with ${((1 - portfolio.effectiveYield/portfolio.expectedReturn) * 100).toFixed(0)}% of returns from price growth, 
                                ideal for long-term wealth building.
                            </div>`
                        }
                    </div>
                    
                    <h4>🥧 Asset Allocation</h4>
                    <div class="allocation-grid">
                        ${Object.entries(portfolio.allocations)
                            .filter(([asset, pct]) => pct > 0)
                            .sort(([,a], [,b]) => b - a)
                            .map(([asset, pct]) => `
                                <div class="allocation-item">
                                    <strong>${asset}</strong><br>
                                    ${pct}%<br>
                                    $${(userInputs.startingCapital * pct / 100).toLocaleString()}<br>
                                    <small style="color: #666;">${assets[asset].name}</small><br>
                                    <small style="color: #999;">${assets[asset].type === 'growth' ? '🚀 Growth' : assets[asset].type === 'income' ? '💰 Income' : '⚖️ Hybrid'}</small>
                                </div>
                            `).join('')}
                    </div>
                    
                    <div class="implementation-steps">
                        <h4>🚀 Implementation Guide</h4>
                        <p><strong>Step-by-step purchase order (${portfolio.strategyBias <= 4 ? 'income assets first' : 'largest positions first'}):</strong></p>
                        <ol>
                            ${Object.entries(portfolio.allocations)
                                .filter(([asset, pct]) => pct > 0)
                                .sort(([assetA, pctA], [assetB, pctB]) => {
                                    // Sort by strategy preference
                                    if (userInputs.strategyBias <= 4) {
                                        // Dividend-focused: income assets first
                                        if (assets[assetA].type === 'income' && assets[assetB].type !== 'income') return -1;
                                        if (assets[assetA].type !== 'income' && assets[assetB].type === 'income') return 1;
                                    }
                                    // Then by size
                                    return pctB - pctA;
                                })
                                .map(([asset, pct]) => 
                                    `<li><strong>Buy ${asset}</strong>: $${(userInputs.startingCapital * pct / 100).toLocaleString()} (${pct}%) - ${assets[asset].name}</li>`
                                ).join('')}
                            <li><strong>Set up automatic dividend reinvestment</strong> ${userInputs.reinvestDividends ? '✅ (Selected)' : '❌ (Consider enabling for compound growth)'}</li>
                            ${userInputs.monthlyContribution > 0 ? `<li><strong>Set up automatic monthly contribution</strong> of $${userInputs.monthlyContribution.toLocaleString()}</li>` : ''}
                            <li><strong>Review and rebalance quarterly</strong> if any asset drifts >10% from target allocation</li>
                        </ol>
                    </div>
                </div>`;
            });
            
            // Add educational note
            html += `
            <div class="warning-card">
                <h3>📚 Strategy-Specific Notes</h3>
                <ul>
                    ${userInputs.strategyBias <= 4 ? `
                        <li><strong>Dividend Focus Strategy:</strong> Your portfolio emphasizes steady income generation through preferred securities with lower volatility.</li>
                        <li><strong>Income Stability:</strong> High allocation to STRC/STRF provides predictable monthly payments regardless of Bitcoin price movements.</li>
                        <li><strong>Lower Risk Profile:</strong> Dividend-focused portfolios typically have smaller drawdowns during market corrections.</li>
                    ` : `
                        <li><strong>Growth Focus Strategy:</strong> Your portfolio prioritizes long-term capital appreciation through Bitcoin exposure (IBIT/MSTR).</li>
                        <li><strong>Higher Volatility:</strong> Growth-focused portfolios experience larger price swings but offer greater upside potential.</li>
                        <li><strong>Bitcoin Leverage:</strong> Higher MSTR allocation provides amplified exposure to Bitcoin price movements.</li>
                    `}
                    <li><strong>Rebalancing:</strong> Quarterly rebalancing helps maintain your target strategy allocation over time.</li>
                    <li><strong>Tax Considerations:</strong> Dividend income is generally taxed as ordinary income; consider tax-advantaged accounts.</li>
                </ul>
            </div>`;
            
            resultsDiv.innerHTML = html;
        }

        // Initialize calculator when page loads
        window.onload = function() {
            document.getElementById('startingCapital').value = '25000';
            document.getElementById('monthlyContribution').value = '1000';
            document.getElementById('targetIncome').value = '500';
            updateSliderValue();
        };
    </script>
</body>
</html>
